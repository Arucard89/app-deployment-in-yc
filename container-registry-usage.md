# Руководство по использованию Container Registry

## Обзор

Добавлено автоматическое создание Container Registry в существующую инфраструктуру Yandex Cloud с помощью Terraform.

## Быстрый старт

### 1. Включение Container Registry

Скопируйте пример конфигурации:

```bash
cp terraform/infrastructure/terraform.tfvars.example terraform/infrastructure/terraform.tfvars
```

Отредактируйте файл:

```hcl
# terraform/infrastructure/terraform.tfvars
folder_id = "b1g..."                    # Ваш folder ID
enable_container_registry = true        # Создать Container Registry
container_registry_name = "my-registry" # Имя реестра
```

### 2. Развертывание инфраструктуры

```bash
cd terraform/infrastructure
terraform init
terraform plan
terraform apply
```

### 3. Получение информации о реестре

```bash
# Получить ID реестра
terraform output container_registry_id

# Получить URL реестра для Docker
terraform output container_registry_url

# Пример вывода: cr.yandex/crp123456789
```

### 4. Использование реестра

```bash
# Вход в реестр (требует yc CLI)
yc iam create-token | docker login --username iam --password-stdin cr.yandex

# Тегирование и загрузка образа
REGISTRY_URL=$(terraform output -raw container_registry_url)
docker tag my-app:latest $REGISTRY_URL/my-app:latest
docker push $REGISTRY_URL/my-app:latest
```

## Варианты конфигурации

### Создание только реестра

```hcl
enable_container_registry = true
enable_container_deployment = false
```

### Использование существующего реестра

```hcl
enable_container_registry = false
existing_container_registry_id = "crp123456789"
enable_container_deployment = true
container_image = "cr.yandex/crp123456789/my-app:latest"
```

### Полная автоматизация

```hcl
enable_container_registry = true
enable_container_deployment = true
container_image = "cr.yandex/<auto-generated-id>/my-app:latest"
```

## Выходные переменные

- `container_registry_id` - ID реестра для API вызовов
- `container_registry_url` - Полный URL для Docker операций
- `container_registry_name` - Человекочитаемое имя

## Примечания

- Реестр создается в той же папке, что и остальные ресурсы
- Использует существующие IAM сервисные аккаунты и разрешения
- Интегрируется с существующими секретами Lockbox для развертывания контейнеров
- Без дополнительных затрат - платите только за хранимые образы
